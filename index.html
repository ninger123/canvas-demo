<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title></title>
    <style>
        #canvas{
            background: green;
            display: block;
        }
        body{
            margin: 0;
        }
        .actions{
            position: fixed;
            bottom: 0;
            left: 0;
        }
        .actions > #brush{
            display: none;
        }

        .actions.x > #brush{
            display: inline-block;
        }
        .actions.x > #eraser{
            display: none
        }


    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id=actions class="actions">
    <button id='eraser'>橡皮擦</button>
    <button id='brush'>画笔</button>
</div>
<script>
    var canvas=document.getElementById('canvas');
    var eraser=document.getElementById('eraser');
    var brush=document.getElementById('brush');
    var context=canvas.getContext('2d');

    getSize();
    listenToUser(canvas);

    var eraserEnabled=false;
    eraser.onclick= function () {
        eraserEnabled=true;
        actions.className='actions x';
    };
    brush.onclick=function(){
        eraserEnabled=false;
        actions.className='actions';
    };

    function listenToUser(canvas){
        var using=false;
        var lastPoint={x:undefined,y:undefined};

        //特性检测
        if(document.body.ontouchstart !== undefined){
            //说明是触屏设备
            canvas.ontouchstart = function(e){
                using=true;
                var x= e.touches[0].clientX;
                var y= e.touches[0].clientY;
                if(eraserEnabled){
                    context.clearRect(x-5,y-5,10,10)
                }
                else{
                    lastPoint={"x":x,"y":y};
                }
            };
            canvas.ontouchmove = function(e){
                var x= e.touches[0].clientX;
                var y= e.touches[0].clientY;
                if(using){
                    if(eraserEnabled){
                        context.clearRect(x-5,y-5,10,10)
                    }
                    else{
                        newPoint={"x":x,"y":y}
                    }

                    drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y);
                    lastPoint = newPoint;  //实时更新最后一个点
                }
            };
            canvas.ontouchend = function(e){
                using=false;
            };
        }
        else{
            //说明是非触屏设备 即PC设备
            canvas.onmousedown= function (e) {
                using=true;
                var x= e.clientX;
                var y= e.clientY;
                if(eraserEnabled){
                    context.clearRect(x-5,y-5,10,10)
                }
                else{
                    lastPoint={"x":x,"y":y};
                }
            };
            canvas.onmousemove=function(e){
                var x= e.clientX;
                var y= e.clientY;
                if(using){
                    if(eraserEnabled){
                        context.clearRect(x-5,y-5,10,10)
                    }
                    else{
                        newPoint={"x":x,"y":y}
                    }

                    drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y);
                    lastPoint = newPoint;  //实时更新最后一个点
                }
            };
            canvas.onmouseup=function(){
                using=false;
            }

        }

    }

    function getSize(){
        var pageWidth=document.documentElement.clientWidth;
        var pageHeight=document.documentElement.clientHeight;

        canvas.width=pageWidth;
        canvas.height=pageHeight;
    }

    window.onresize=function(){
        getSize();
    };

    function drawLine(x1,y1,x2,y2){
        context.beginPath();
        context.strokeStyle='black';
        context.moveTo(x1,y1);   //起点
        context.lineWidth=5;
        context.lineTo(x2,y2);   //终点
        context.stroke();
        context.closePath();
    }


</script>
</body>
</html>